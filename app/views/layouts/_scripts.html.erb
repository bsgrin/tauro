<script type="text/javascript">
  
  // var previousColored = null

  function fadeElem(elems, index) {
    var elem = $( '#' + elems[index].id )
    elem.fadeIn(400, function () {
      setTimeout(function () { 
        elem.fadeOut(400, function () {
          fadeElem( elems, (index + 1) % elems.length )
        })
      }, 5000)
    })
  }

  function grayImages (small, medium) {
    var mainArt = $('#mainArt')
    // if (mainArt.attr('src') === medium)
    //   return
    var smallImage = $('img[src="' + small + '"]');
    var mediumImage = $('img[src="' + medium + '"]')
    var allColored = $(".colored");
    $.each(allColored, function (index) { 
      $(allColored[index]).addClass("gray").removeClass("colored")
    })
    smallImage.removeClass('gray').addClass('colored')

    mainArt.fadeTo(400, 0.01, function () {
      mainArt.attr('src', medium).one('load', function() {  
        mainArt.fadeTo(400, 1)
      })
    })
  }

  function preloadImages(imagesToPreload) {
    document.preloaded_images = []
    $.each(imagesToPreload, function(index) {
      var image = new Image
      image.src = imagesToPreload[index]
      document.preloaded_images.push(image)
    })
  }

  jQuery(function() {
    $(".link-to-gallery")
      .on("ajax:complete", function(xhr, status, error) {
        var imagesToPreload = <%= preloaded_images @gallery_to_show, :medium %>
        preloadImages(imagesToPreload)
      });
  });

</script>